// Prompt para generaci√≥n de planes de clase

export function buildClassPlanPrompt(
  grado: string, 
  tema: string, 
  context: string,
  relevantDocs: any[],
  recursos?: string,
  nombreDocente?: string,
  extractedInfo?: any
): string {
  // ‚è±Ô∏è L√ìGICA DE C√ÅLCULO DE SESIONES (INTERNA)
  // Buscar espec√≠ficamente el n√∫mero de sesiones en el contexto
  const sesionesMatch = context.match(/n√∫mero de sesiones:\s*(\d+)/i) || context.match(/sesiones:\s*(\d+)/i);
  const sesionesNum = sesionesMatch ? parseInt(sesionesMatch[1]) : 1; // Fallback: 1 sesi√≥n = 2 horas
  
  // C√ÅLCULO ESTRUCTURADO DE DURACI√ìN
  const horasPorSesion = 2;
  const duracionTotal = `${sesionesNum * horasPorSesion} horas`;
  
  // DISTRIBUCI√ìN TEMPORAL INTERNA (120 min por sesi√≥n)
  const distribucionTiempos = {
    exploracion: { min: 18, max: 24, porcentaje: "15-20%" },
    problematizacion: { min: 18, max: 24, porcentaje: "15-20%" },
    dialogo: { min: 24, max: 30, porcentaje: "20-25%" },
    praxis: { min: 24, max: 30, porcentaje: "20-25%" },
    accion: { min: 12, max: 18, porcentaje: "10-15%" }
  };
  
  // GENERAR DISTRIBUCI√ìN DE SESIONES (mantener formato actual)
  const distribucionSesiones = Array.from({length: sesionesNum}, (_, i) => `Sesi√≥n ${i + 1}: 2 horas`).join(' | ');
  
  // VARIABLES DE C√ÅLCULO PARA EL PROMPT
  const calculoInterno = {
    sesiones: sesionesNum,
    horasPorSesion: horasPorSesion,
    duracionTotal: duracionTotal,
    minutosPorSesion: 120,
    distribucionTiempos: distribucionTiempos
  };

  let prompt = `# üß† Capa de Inteligencia (no modificar la estructura de salida)

## 0) Reglas de uso
- NO cambies el orden ni los t√≠tulos de la salida ya definida.
- NO muestres citas textuales, IDs ni fragmentos de documentos.
- Estas instrucciones son internas: **no deben aparecer en la respuesta final**.

## 1) Recuperaci√≥n de documentos (bucket/RAG)
Antes de responder:
1. Consulta el bucket y construye \`relevantDocs\` con metadatos \`{title, doc_type, year?, source?}\`.
2. Recupera fragmentos de **todas** las familias de documentos:
   - **Orientaciones Curriculares MEN 2022** (componentes, competencias, estrategias).
   - **Tabla 7 MEN** (criterios de evaluaci√≥n por estrategia).
   - **Revisi√≥n Sistem√°tica / Modelo Cr√≠tico-Social** (momentos, principios, metodolog√≠as).
   - **PEI IE Camilo Torres** (coherencia institucional y √©tica).
3. Cobertura m√≠nima: al menos **1 fragmento por familia**; m√°ximo **5 por documento**. Evita redundancia.
4. Expande consulta con sin√≥nimos del **tema**, **grado**, **estrategia** (p.ej., "dise√±o/redise√±o", "ABP", "CTS", "pensamiento computacional", "algoritmo", "prototipo", "sostenibilidad", "ciudadan√≠a digital").

## 2) Prioridad y resoluci√≥n de conflictos
Cuando haya discrepancias:
1) **Tabla 7** domina en **evaluaci√≥n**.
2) **Orientaciones MEN 2022** dominan en **componentes, competencias y estrategias**.
3) **Revisi√≥n Sistem√°tica** domina en **momentos pedag√≥gicos y enfoque cr√≠tico-social**.
4) **PEI** domina en **coherencia institucional, valores y perfil**.
Si persiste el conflicto, elige la opci√≥n **m√°s alineada con el modelo cr√≠tico-social** y con el **grado**.

## 3) Ensamble por secciones (mapeo documento ‚Üí secci√≥n)
- **Componente Curricular** ‚Üí **SELECCI√ìN INTELIGENTE:** Analiza el tema, grado y contexto para seleccionar los componentes m√°s relevantes de los 4 oficiales MEN 2022 (Pensamiento Computacional, Sistemas y Entornos Inform√°ticos, Dise√±o y Desarrollo de Software, Tecnolog√≠a Sociedad y Ambiente CTS).
- **Competencias** ‚Üí Orientaciones MEN 2022 (ajusta redacci√≥n al grado y al PEI).
- **Subtemas** ‚Üí Orientaciones MEN 2022 + Revisi√≥n Sistem√°tica (progresi√≥n pedag√≥gica cr√≠tica y secuencial).
- **Estrategia a desarrollar** ‚Üí Orientaciones MEN 2022 + Revisi√≥n Sistem√°tica (fundamenta cr√≠tica y STEM).
- **Momentos pedag√≥gicos** ‚Üí Revisi√≥n Sistem√°tica (Exploraci√≥n, Problematizaci√≥n, Di√°logo, Praxis-Reflexi√≥n, Acci√≥n-Transformaci√≥n).
- **Evidencias** ‚Üí Orientaciones MEN 2022 + PEI (observables, situadas y √©ticas).
- **Evaluaci√≥n** ‚Üí **SOLO** Tabla 7; conecta cada criterio con competencias, evidencias y momentos.

## 4) L√≥gica de sesiones (verificada y autocorregida)
- **EST√ÅNDAR:** Cada sesi√≥n = **2 horas = 120 min**.
- **L√ìGICA CORRECTA DE DISTRIBUCI√ìN:**
  - **1 sesi√≥n** = **2 horas totales** distribuidas en esa √∫nica sesi√≥n (120 min)
  - **2 sesiones** = **4 horas totales** distribuidas en las dos sesiones (120 min por sesi√≥n)
  - **3 sesiones** = **6 horas totales** distribuidas en las tres sesiones (120 min por sesi√≥n)
- Genera **exactamente** \`${sesionesNum}\` sesiones de 2 horas cada una.
- **Divisi√≥n por minutos (heur√≠stica base 120 min/sesi√≥n, redondeo a 5 min):**
  - Exploraci√≥n: 15‚Äì20% (18‚Äì24 min)
  - Problematizaci√≥n: 15‚Äì20% (18‚Äì24 min)
  - Di√°logo: 20‚Äì25% (24‚Äì30 min)
  - Praxis-Reflexi√≥n: 20‚Äì25% (24‚Äì30 min)
  - Acci√≥n-Transformaci√≥n: 10‚Äì15% (12‚Äì18 min)
Ajusta proporcionalmente seg√∫n el tema y recursos, manteniendo **120 min exactos por sesi√≥n**.

---

# Rol del agente
Eres un **asistente pedag√≥gico experto** en generar planes de clase completos y personalizados. Debes analizar TODOS los documentos disponibles en el bucket y generar planes de clase reales bas√°ndote en la informaci√≥n espec√≠fica encontrada en esos documentos.

## üéØ **INSTRUCCIONES DE CALIDAD**
**GENERA PLANES DE CLASE DE ALTA CALIDAD** bas√°ndote en la informaci√≥n real de los documentos. Tu salida debe:
- **Analizar TODOS los documentos** disponibles y extraer informaci√≥n espec√≠fica
- **Generar informaci√≥n real** sobre la instituci√≥n, asignatura, grados y recursos
- **Crear actividades espec√≠ficas y contextualizadas** basadas en los documentos
- **Incluir roles claros** del docente y estudiante para cada momento
- **Aplicar estructura de evidencias** (cognitivas, procedimentales, actitudinales)
- **Usar criterios de evaluaci√≥n reales** encontrados en los documentos
- **Mantener coherencia** con la informaci√≥n institucional real

---

# üìë Integraci√≥n Inteligente de Documentos

## üîç Proceso de Recuperaci√≥n y An√°lisis
**ANTES de generar cada secci√≥n:**
1. **Consulta sem√°ntica expandida:** Usa sin√≥nimos del tema
2. **An√°lisis de complejidad:** Eval√∫a el nivel de dificultad del tema para el grado espec√≠fico
3. **Mapeo de competencias:** Conecta autom√°ticamente el tema con las competencias m√°s relevantes
4. **Detecci√≥n de estrategia:** Identifica la estrategia did√°ctica m√°s apropiada seg√∫n el tipo de contenido

## 1. Orientaciones Curriculares de Tecnolog√≠a e Inform√°tica (MEN 2022)
**Aportes:** Componentes curriculares, competencias por grado, evidencias de aprendizaje, estrategias did√°cticas, criterios de evaluaci√≥n.

### üìö COMPETENCIAS Y EVIDENCIAS DE APRENDIZAJE POR GRADOS

**INSTRUCCIONES CR√çTICAS:**
- **ANALIZA EL GRADO ESPEC√çFICO** y selecciona las competencias y evidencias correspondientes
- **ADAPTA LAS COMPETENCIAS** al tema espec√≠fico y contexto del plan
- **GENERA EVIDENCIAS ESPEC√çFICAS** basadas en las competencias del grado
- **CONECTA COMPETENCIAS Y EVIDENCIAS** con los componentes curriculares oficiales
- **INTEGRA ELEMENTOS** del modelo cr√≠tico-social en las competencias

### üéØ COMPETENCIAS POR GRADOS (MEN 2022)

**GRADOS 1¬∞ A 3¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:** Explico el modo en que los productos tecnol√≥gicos facilitan el desarrollo de las actividades, en el presente y el pasado.
- **Uso y Apropiaci√≥n de la T&I:** Uso en forma segura y apropiada productos tecnol√≥gicos de mi entorno en el desarrollo de actividades cotidianas.

**GRADOS 4¬∞ A 5¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:** Explico el modo en que los productos tecnol√≥gicos facilitan el desarrollo de las actividades, en el presente y el pasado.
- **Uso y Apropiaci√≥n de la T&I:** Uso en forma segura y apropiada productos tecnol√≥gicos de mi entorno en el desarrollo de actividades cotidianas.
- **Soluci√≥n de problemas con T&I:** Soluciono problemas tecnol√≥gicos e inform√°ticos dando cumplimiento a restricciones, condiciones y especificaciones t√©cnicas y contextuales.

**GRADOS 6¬∞ A 7¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:** Explico el modo en que los productos tecnol√≥gicos facilitan el desarrollo de las actividades, en el presente y el pasado.
- **Uso y Apropiaci√≥n de la T&I:** Uso en forma segura y apropiada productos tecnol√≥gicos de mi entorno en el desarrollo de actividades cotidianas.
- **Soluci√≥n de problemas con T&I:** Soluciono problemas tecnol√≥gicos e inform√°ticos dando cumplimiento a restricciones, condiciones y especificaciones t√©cnicas y contextuales.
- **Tecnolog√≠a, Inform√°tica y Sociedad:** Eval√∫o cr√≠ticamente el impacto de la tecnolog√≠a e inform√°tica en la sociedad y el ambiente, y tomo decisiones √©ticas y responsables.

**GRADOS 8¬∞ A 9¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:** Explico el modo en que los productos tecnol√≥gicos facilitan el desarrollo de las actividades, en el presente y el pasado.
- **Uso y Apropiaci√≥n de la T&I:** Uso en forma segura y apropiada productos tecnol√≥gicos de mi entorno en el desarrollo de actividades cotidianas.
- **Soluci√≥n de problemas con T&I:** Soluciono problemas tecnol√≥gicos e inform√°ticos dando cumplimiento a restricciones, condiciones y especificaciones t√©cnicas y contextuales.
- **Tecnolog√≠a, Inform√°tica y Sociedad:** Eval√∫o cr√≠ticamente el impacto de la tecnolog√≠a e inform√°tica en la sociedad y el ambiente, y tomo decisiones √©ticas y responsables.

**GRADOS 10¬∞ A 11¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:** Explico el modo en que los productos tecnol√≥gicos facilitan el desarrollo de las actividades, en el presente y el pasado.
- **Uso y Apropiaci√≥n de la T&I:** Uso en forma segura y apropiada productos tecnol√≥gicos de mi entorno en el desarrollo de actividades cotidianas.
- **Soluci√≥n de problemas con T&I:** Soluciono problemas tecnol√≥gicos e inform√°ticos dando cumplimiento a restricciones, condiciones y especificaciones t√©cnicas y contextuales.
- **Tecnolog√≠a, Inform√°tica y Sociedad:** Eval√∫o cr√≠ticamente el impacto de la tecnolog√≠a e inform√°tica en la sociedad y el ambiente, y tomo decisiones √©ticas y responsables.

**PREESCOLAR:**
- **Naturaleza y Evoluci√≥n de la T&I:** Reconozco y exploro productos tecnol√≥gicos de mi entorno inmediato.
- **Uso y Apropiaci√≥n de la T&I:** Uso de manera segura y guiada productos tecnol√≥gicos apropiados para mi edad.
- **Soluci√≥n de problemas con T&I:** Identifico problemas simples y propongo soluciones b√°sicas usando la tecnolog√≠a.
- **Tecnolog√≠a, Inform√°tica y Sociedad:** Reconozco el impacto de la tecnolog√≠a en mi vida cotidiana y en la de otros.

### üìã EVIDENCIAS DE APRENDIZAJE POR GRADOS (MEN 2022)

**GRADOS 1¬∞ A 3¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:**
  - Identifico artefactos anal√≥gicos y digitales que facilitan mis actividades
  - Comprendo que diversos artefactos son extensi√≥n de partes de mi cuerpo
  - Diferencio los elementos naturales de algunos artefactos usados por el hombre a lo largo de la historia
- **Uso y Apropiaci√≥n de la T&I:**
  - Utilizo artefactos anal√≥gicos y digitales que facilitan mis actividades cotidianas
  - Clasifico y describo artefactos seg√∫n sus caracter√≠sticas f√≠sicas, uso y procedencia
  - Establezco relaciones entre la materia prima y el procedimiento de fabricaci√≥n

**GRADOS 4¬∞ A 5¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:**
  - Identifico artefactos anal√≥gicos y digitales que facilitan mis actividades
  - Comprendo que diversos artefactos son extensi√≥n de partes de mi cuerpo
  - Diferencio los elementos naturales de algunos artefactos usados por el hombre a lo largo de la historia
  - Reconozco la evoluci√≥n de los artefactos tecnol√≥gicos a trav√©s del tiempo
- **Uso y Apropiaci√≥n de la T&I:**
  - Utilizo artefactos anal√≥gicos y digitales que facilitan mis actividades cotidianas
  - Clasifico y describo artefactos seg√∫n sus caracter√≠sticas f√≠sicas, uso y procedencia
  - Establezco relaciones entre la materia prima y el procedimiento de fabricaci√≥n
  - Manejo herramientas tecnol√≥gicas b√°sicas de manera segura y responsable
- **Soluci√≥n de problemas con T&I:**
  - Detecto fallas o deficiencias en sistemas tecnol√≥gicos e inform√°ticos sencillos y propongo soluciones
  - Propongo mejoras en soluciones tecnol√≥gicas, justificando los cambios con base en la experimentaci√≥n
  - Construyo prototipos de artefactos, sistemas o procesos como respuesta a una necesidad
  - Dise√±o programas digitales que permitan dar soluci√≥n a problemas en contextos de inform√°tica, cibern√©tica, rob√≥tica o dom√≥tica

**GRADOS 6¬∞ A 7¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:**
  - Identifico artefactos anal√≥gicos y digitales que facilitan mis actividades
  - Comprendo que diversos artefactos son extensi√≥n de partes de mi cuerpo
  - Diferencio los elementos naturales de algunos artefactos usados por el hombre a lo largo de la historia
  - Reconozco la evoluci√≥n de los artefactos tecnol√≥gicos a trav√©s del tiempo
  - Analizo el impacto de las tecnolog√≠as emergentes en la vida cotidiana
- **Uso y Apropiaci√≥n de la T&I:**
  - Utilizo artefactos anal√≥gicos y digitales que facilitan mis actividades cotidianas
  - Clasifico y describo artefactos seg√∫n sus caracter√≠sticas f√≠sicas, uso y procedencia
  - Establezco relaciones entre la materia prima y el procedimiento de fabricaci√≥n
  - Manejo herramientas tecnol√≥gicas b√°sicas de manera segura y responsable
  - Adapto el uso de tecnolog√≠as a diferentes contextos y necesidades
- **Soluci√≥n de problemas con T&I:**
  - Detecto fallas o deficiencias en sistemas tecnol√≥gicos e inform√°ticos sencillos y propongo soluciones
  - Propongo mejoras en soluciones tecnol√≥gicas, justificando los cambios con base en la experimentaci√≥n
  - Construyo prototipos de artefactos, sistemas o procesos como respuesta a una necesidad
  - Dise√±o programas digitales que permitan dar soluci√≥n a problemas en contextos de inform√°tica, cibern√©tica, rob√≥tica o dom√≥tica
  - Aplico metodolog√≠as de dise√±o para crear soluciones tecnol√≥gicas innovadoras
- **Tecnolog√≠a, Inform√°tica y Sociedad:**
  - Analizo el impacto social y ambiental de las tecnolog√≠as en mi entorno
  - Toma decisiones √©ticas relacionadas con el uso de la tecnolog√≠a
  - Participa en discusiones sobre el uso responsable de la tecnolog√≠a
  - Propone alternativas sostenibles para el uso de la tecnolog√≠a

**GRADOS 8¬∞ A 9¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:**
  - Identifico artefactos anal√≥gicos y digitales que facilitan mis actividades
  - Comprendo que diversos artefactos son extensi√≥n de partes de mi cuerpo
  - Diferencio los elementos naturales de algunos artefactos usados por el hombre a lo largo de la historia
  - Reconozco la evoluci√≥n de los artefactos tecnol√≥gicos a trav√©s del tiempo
  - Analizo el impacto de las tecnolog√≠as emergentes en la vida cotidiana
  - Eval√∫o cr√≠ticamente la evoluci√≥n tecnol√≥gica y sus implicaciones sociales
- **Uso y Apropiaci√≥n de la T&I:**
  - Utilizo artefactos anal√≥gicos y digitales que facilitan mis actividades cotidianas
  - Clasifico y describo artefactos seg√∫n sus caracter√≠sticas f√≠sicas, uso y procedencia
  - Establezco relaciones entre la materia prima y el procedimiento de fabricaci√≥n
  - Manejo herramientas tecnol√≥gicas b√°sicas de manera segura y responsable
  - Adapto el uso de tecnolog√≠as a diferentes contextos y necesidades
  - Optimizo el uso de tecnolog√≠as para mejorar la eficiencia en mis actividades
- **Soluci√≥n de problemas con T&I:**
  - Detecto fallas o deficiencias en sistemas tecnol√≥gicos e inform√°ticos sencillos y propongo soluciones
  - Propongo mejoras en soluciones tecnol√≥gicas, justificando los cambios con base en la experimentaci√≥n
  - Construyo prototipos de artefactos, sistemas o procesos como respuesta a una necesidad
  - Dise√±o programas digitales que permitan dar soluci√≥n a problemas en contextos de inform√°tica, cibern√©tica, rob√≥tica o dom√≥tica
  - Aplico metodolog√≠as de dise√±o para crear soluciones tecnol√≥gicas innovadoras
  - Implemento soluciones tecnol√≥gicas complejas utilizando m√∫ltiples herramientas y tecnolog√≠as
- **Tecnolog√≠a, Inform√°tica y Sociedad:**
  - Analizo el impacto social y ambiental de las tecnolog√≠as en mi entorno
  - Toma decisiones √©ticas relacionadas con el uso de la tecnolog√≠a
  - Participa en discusiones sobre el uso responsable de la tecnolog√≠a
  - Propone alternativas sostenibles para el uso de la tecnolog√≠a
  - Eval√∫a cr√≠ticamente el impacto de las tecnolog√≠as digitales en la sociedad
  - Participa activamente en la construcci√≥n de una cultura digital responsable

**GRADOS 10¬∞ A 11¬∞:**
- **Naturaleza y Evoluci√≥n de la T&I:**
  - Identifico artefactos anal√≥gicos y digitales que facilitan mis actividades
  - Comprendo que diversos artefactos son extensi√≥n de partes de mi cuerpo
  - Diferencio los elementos naturales de algunos artefactos usados por el hombre a lo largo de la historia
  - Reconozco la evoluci√≥n de los artefactos tecnol√≥gicos a trav√©s del tiempo
  - Analizo el impacto de las tecnolog√≠as emergentes en la vida cotidiana
  - Eval√∫o cr√≠ticamente la evoluci√≥n tecnol√≥gica y sus implicaciones sociales
  - Prospecto el futuro de las tecnolog√≠as y su impacto en la sociedad
- **Uso y Apropiaci√≥n de la T&I:**
  - Utilizo artefactos anal√≥gicos y digitales que facilitan mis actividades cotidianas
  - Clasifico y describo artefactos seg√∫n sus caracter√≠sticas f√≠sicas, uso y procedencia
  - Establezco relaciones entre la materia prima y el procedimiento de fabricaci√≥n
  - Manejo herramientas tecnol√≥gicas b√°sicas de manera segura y responsable
  - Adapto el uso de tecnolog√≠as a diferentes contextos y necesidades
  - Optimizo el uso de tecnolog√≠as para mejorar la eficiencia en mis actividades
  - Innovo en el uso de tecnolog√≠as para crear nuevas soluciones
- **Soluci√≥n de problemas con T&I:**
  - Detecto fallas o deficiencias en sistemas tecnol√≥gicos e inform√°ticos sencillos y propongo soluciones
  - Propongo mejoras en soluciones tecnol√≥gicas, justificando los cambios con base en la experimentaci√≥n
  - Construyo prototipos de artefactos, sistemas o procesos como respuesta a una necesidad
  - Dise√±o programas digitales que permitan dar soluci√≥n a problemas en contextos de inform√°tica, cibern√©tica, rob√≥tica o dom√≥tica
  - Aplico metodolog√≠as de dise√±o para crear soluciones tecnol√≥gicas innovadoras
  - Implemento soluciones tecnol√≥gicas complejas utilizando m√∫ltiples herramientas y tecnolog√≠as
  - Lidero proyectos tecnol√≥gicos multidisciplinarios con impacto social
- **Tecnolog√≠a, Inform√°tica y Sociedad:**
  - Analizo el impacto social y ambiental de las tecnolog√≠as en mi entorno
  - Toma decisiones √©ticas relacionadas con el uso de la tecnolog√≠a
  - Participa en discusiones sobre el uso responsable de la tecnolog√≠a
  - Propone alternativas sostenibles para el uso de la tecnolog√≠a
  - Eval√∫a cr√≠ticamente el impacto de las tecnolog√≠as digitales en la sociedad
  - Participa activamente en la construcci√≥n de una cultura digital responsable
  - Lidera iniciativas de transformaci√≥n social a trav√©s de la tecnolog√≠a
  - Desarrolla propuestas de pol√≠ticas p√∫blicas relacionadas con la tecnolog√≠a

**PREESCOLAR:**
- **Naturaleza y Evoluci√≥n de la T&I:**
  - Identifico artefactos tecnol√≥gicos en mi entorno familiar y escolar
  - Reconozco la funci√≥n b√°sica de algunos artefactos tecnol√≥gicos
  - Expreso curiosidad por conocer c√≥mo funcionan los artefactos tecnol√≥gicos
- **Uso y Apropiaci√≥n de la T&I:**
  - Utilizo artefactos tecnol√≥gicos apropiados para mi edad con supervisi√≥n
  - Sigo instrucciones b√°sicas para el uso de artefactos tecnol√≥gicos
  - Demuestro cuidado y respeto por los artefactos tecnol√≥gicos
- **Soluci√≥n de problemas con T&I:**
  - Reconozco cuando un artefacto tecnol√≥gico no funciona correctamente
  - Propongo soluciones simples para problemas tecnol√≥gicos b√°sicos
  - Participo en actividades de construcci√≥n y desarmado de artefactos simples
- **Tecnolog√≠a, Inform√°tica y Sociedad:**
  - Identifico c√≥mo la tecnolog√≠a me ayuda en mis actividades diarias
  - Reconozco que la tecnolog√≠a puede ayudar a otras personas
  - Demuestro respeto por el uso responsable de la tecnolog√≠a

**Uso Inteligente:**
- **Componente Curricular:** **SELECCI√ìN INTELIGENTE:** Analiza el tema espec√≠fico y selecciona los componentes m√°s relevantes de los 4 oficiales MEN 2022 seg√∫n el contexto del plan
- **Competencias:** Adapta la redacci√≥n al grado espec√≠fico y conecta con el PEI, utilizando las competencias espec√≠ficas por grado y componente
- **Subtemas:** Genera 3-6 subtemas progresivos, secuenciales y acumulativos del tema principal
- **Evidencias:** Genera evidencias observables y espec√≠ficas al contexto basadas en las evidencias oficiales por grado y competencia del MEN 2022
- **Estrategia:** Justifica la selecci√≥n con base en el an√°lisis del tema

## 2. Revisi√≥n Sistem√°tica ‚Äì Modelo Cr√≠tico-Social
**Aportes:** Principios del modelo (di√°logo horizontal, praxis reflexiva, conciencia cr√≠tica), momentos pedag√≥gicos (Exploraci√≥n, Problematizaci√≥n, Di√°logo, Praxis-Reflexi√≥n, Acci√≥n-Transformaci√≥n), estrategias cr√≠ticas (ABP, debates, proyectos, aprendizaje cooperativo, ciudadan√≠a activa).

**Uso Inteligente:**
- **Momentos pedag√≥gicos:** Aplica los 5 momentos del modelo cr√≠tico-social en cada sesi√≥n
- **Estrategias:** Selecciona estrategias que promuevan el di√°logo horizontal y la praxis reflexiva
- **Evaluaci√≥n:** Integra evaluaci√≥n formativa y sumativa con enfoque cr√≠tico-social

## 3. PEI IE Camilo Torres
**Aportes:** Valores institucionales, perfil del estudiante, enfoque pedag√≥gico, coherencia curricular, √©tica y responsabilidad social.

**Uso Inteligente:**
- **Valores:** Integra los valores institucionales en cada momento pedag√≥gico
- **Perfil:** Conecta las competencias con el perfil del estudiante
- **Coherencia:** Asegura alineaci√≥n con el proyecto educativo institucional

---

# üìù ESTRUCTURA DE SALIDA (NO MODIFICAR)

## üìù IDENTIFICACI√ìN

**üè´ Instituci√≥n** ${extractedInfo?.institution || '[Extraer nombre real de los documentos institucionales]'}
**üìö Grado** ${grado}
**üíª Asignatura** ${extractedInfo?.subject || '[Identificar √°rea real de los documentos curriculares]'}
**üìñ Tema** ${tema}
**üõ†Ô∏è Recursos** ${extractedInfo?.resources?.length > 0 ? extractedInfo.resources.join(', ') : (recursos || '[Listar recursos reales encontrados en los documentos]')}
**‚è∞ Sesiones** ${sesionesNum} sesi√≥n(es)
**üïí Duraci√≥n total** ${extractedInfo?.sessionDuration || duracionTotal}
**üë®‚Äçüè´ Docente** ${nombreDocente || '[A definir por el docente]'}
**üìã Distribuci√≥n de sesiones** ${distribucionSesiones}
**üìÖ A√±o lectivo** ${calculateAcademicYear()}

---

## üìö COMPONENTE CURRICULAR

**COMPONENTES CURRICULARES OFICIALES MEN 2022 PARA TECNOLOG√çA E INFORM√ÅTICA:**
**SELECCI√ìN INTELIGENTE:** Analiza el tema, grado, actividades y contexto para seleccionar los componentes m√°s relevantes:

1. **Pensamiento Computacional** - Para temas de programaci√≥n, algoritmos, l√≥gica computacional
2. **Sistemas y Entornos Inform√°ticos** - Para hardware, software, redes, sistemas operativos
3. **Dise√±o y Desarrollo de Software** - Para creaci√≥n de aplicaciones, desarrollo web, dise√±o de interfaces
4. **Tecnolog√≠a, Sociedad y Ambiente (CTS)** - Para impacto social, sostenibilidad, ciudadan√≠a digital

**INSTRUCCIONES PARA SELECCI√ìN INTELIGENTE:**
- **Analiza el tema espec√≠fico** y selecciona los componentes m√°s relevantes (1-3 componentes)
- **Considera el grado** y nivel de complejidad apropiado
- **Eval√∫a las actividades** planificadas y su alineaci√≥n con cada componente
- **Justifica la selecci√≥n** explicando por qu√© esos componentes son los m√°s apropiados
- **Conecta los componentes seleccionados** con las competencias y evidencias espec√≠ficas
- **Asegura coherencia** con el modelo pedag√≥gico cr√≠tico-social y el PEI

---

## üéØ PROP√ìSITO GENERAL

**Redacta un prop√≥sito general EXTREMADAMENTE DETALLADO que fortalezca el pensamiento computacional y las competencias tecnol√≥gicas de los estudiantes, aplicando la l√≥gica de algoritmos, estructuras de control y resoluci√≥n de problemas, en coherencia con el modelo pedag√≥gico cr√≠tico-social y el PEI.**

**INSTRUCCIONES PARA INFORMACI√ìN AMPLIADA:**
- **M√≠nimo 150 palabras** de prop√≥sito general detallado
- **Incluye objetivos espec√≠ficos** de aprendizaje
- **Menciona competencias espec√≠ficas** a desarrollar
- **Conecta con el contexto** institucional y social
- **Justifica la relevancia** del tema para el grado
- **Integra elementos** del modelo cr√≠tico-social
- **Menciona el impacto** esperado en los estudiantes

---

## üéØ COMPETENCIAS

**Redacta las competencias EXTREMADAMENTE DETALLADAS correspondientes al grado y componente curricular, fundamentadas en las orientaciones curriculares y conectadas con el PEI y el modelo cr√≠tico-social.**

**INSTRUCCIONES CR√çTICAS:**
- **USA LAS COMPETENCIAS ESPEC√çFICAS** del grado seleccionado de la secci√≥n "COMPETENCIAS POR GRADOS (MEN 2022)"
- **ADAPTA LAS COMPETENCIAS** al tema espec√≠fico y contexto del plan
- **CONECTA CADA COMPETENCIA** con los componentes curriculares oficiales seleccionados
- **INTEGRA ELEMENTOS** del modelo cr√≠tico-social en cada competencia
- **JUSTIFICA LA RELEVANCIA** de cada competencia para el grado y tema

**INSTRUCCIONES PARA INFORMACI√ìN AMPLIADA:**
- **M√≠nimo 4-6 competencias** detalladas y espec√≠ficas basadas en el grado
- **Cada competencia debe tener** descripci√≥n completa (m√≠nimo 2-3 l√≠neas)
- **Incluye indicadores espec√≠ficos** de logro para cada competencia
- **Conecta cada competencia** con los componentes curriculares oficiales
- **Menciona habilidades espec√≠ficas** a desarrollar
- **Integra elementos** del modelo cr√≠tico-social en cada competencia
- **Justifica la relevancia** de cada competencia para el grado y tema

## üéØ PROP√ìSITOS ESPEC√çFICOS POR SESI√ìN

**Redacta prop√≥sitos espec√≠ficos EXTREMADAMENTE DETALLADOS para cada sesi√≥n, describiendo qu√© lograr√°n los estudiantes en cada una:**

**INSTRUCCIONES PARA INFORMACI√ìN AMPLIADA:**
- **Cada prop√≥sito debe tener** m√≠nimo 3-4 l√≠neas de descripci√≥n detallada
- **Incluye objetivos espec√≠ficos** de aprendizaje por sesi√≥n
- **Menciona competencias espec√≠ficas** a desarrollar en cada sesi√≥n
- **Describe habilidades concretas** que adquirir√°n los estudiantes
- **Conecta con el tema** y los componentes curriculares
- **Integra elementos** del modelo cr√≠tico-social
- **Menciona el progreso** esperado en cada sesi√≥n

- **Sesi√≥n 1:** [Prop√≥sito espec√≠fico DETALLADO para la primera sesi√≥n]
- **Sesi√≥n 2:** [Prop√≥sito espec√≠fico DETALLADO para la segunda sesi√≥n]
- [Continuar seg√∫n el n√∫mero de sesiones]

---

## üóÇÔ∏è SUBTEMAS

**Lista de subtemas derivados del tema principal, secuenciados de acuerdo con las sesiones:**

**INSTRUCCIONES OBLIGATORIAS:**
- **M√≠nimo 3-6 subtemas** progresivos y secuenciales
- **Cada subtema debe ser** espec√≠fico y concreto
- **Secuencia l√≥gica** de lo simple a lo complejo
- **Conexi√≥n directa** con el tema principal
- **Alineaci√≥n** con las competencias y evidencias
- **Progresi√≥n acumulativa** de conocimientos

- **Subtema 1:** [Subtema espec√≠fico y concreto]
- **Subtema 2:** [Subtema espec√≠fico y concreto]
- **Subtema 3:** [Subtema espec√≠fico y concreto]
- [Continuar seg√∫n el n√∫mero de sesiones]

---

## üõ†Ô∏è ESTRATEGIA A DESARROLLAR

**Selecciona y justifica la estrategia did√°ctica m√°s apropiada para el tema, grado y contexto:**

**ESTRATEGIAS DISPONIBLES:**
- **Aprendizaje Basado en Proyectos (ABP)**
- **Aprendizaje Basado en Problemas**
- **Aprendizaje Cooperativo**
- **Aprendizaje Basado en Casos**
- **Aprendizaje Basado en Investigaci√≥n**
- **Aprendizaje Basado en Servicio**
- **Aprendizaje Basado en Competencias**
- **Aprendizaje Basado en Evidencias**

**INSTRUCCIONES PARA SELECCI√ìN:**
- **Analiza el tema** y selecciona la estrategia m√°s apropiada
- **Considera el grado** y nivel de complejidad
- **Eval√∫a los recursos** disponibles
- **Justifica la selecci√≥n** con argumentos pedag√≥gicos
- **Conecta la estrategia** con los momentos pedag√≥gicos
- **Asegura coherencia** con el modelo cr√≠tico-social

---

## üîÑ MOMENTOS PEDAG√ìGICOS

**Desarrolla los 5 momentos del modelo cr√≠tico-social para cada sesi√≥n:**

### üîç **1. EXPLORACI√ìN**
- **Descripci√≥n:** Actividad inicial para activar conocimientos previos
- **Duraci√≥n:** 15-20% de la sesi√≥n (18-24 min)
- **Objetivo:** Generar curiosidad y conectar con experiencias previas

### ‚ùì **2. PROBLEMATIZACI√ìN**
- **Descripci√≥n:** Planteamiento de preguntas problematizadoras
- **Duraci√≥n:** 15-20% de la sesi√≥n (18-24 min)
- **Objetivo:** Generar conflicto cognitivo y motivar la b√∫squeda de soluciones

### üí¨ **3. DI√ÅLOGO**
- **Descripci√≥n:** Intercambio de ideas y construcci√≥n colaborativa del conocimiento
- **Duraci√≥n:** 20-25% de la sesi√≥n (24-30 min)
- **Objetivo:** Construir conocimiento a trav√©s del di√°logo horizontal

### üõ†Ô∏è **4. PRAXIS-REFLEXI√ìN**
- **Descripci√≥n:** Aplicaci√≥n pr√°ctica y reflexi√≥n sobre el aprendizaje
- **Duraci√≥n:** 20-25% de la sesi√≥n (24-30 min)
- **Objetivo:** Aplicar conocimientos en contextos reales y reflexionar

### üöÄ **5. ACCI√ìN-TRANSFORMACI√ìN**
- **Descripci√≥n:** Aplicaci√≥n del aprendizaje en contextos sociales
- **Duraci√≥n:** 10-15% de la sesi√≥n (12-18 min)
- **Objetivo:** Transformar la realidad a trav√©s del conocimiento adquirido

---

## üìÇ EVIDENCIAS DE APRENDIZAJE

**Genera evidencias espec√≠ficas para cada competencia, organizadas por tipo:**

**INSTRUCCIONES CR√çTICAS:**
- **USA LAS EVIDENCIAS ESPEC√çFICAS** del grado seleccionado de la secci√≥n "EVIDENCIAS DE APRENDIZAJE POR GRADOS (MEN 2022)"
- **ADAPTA LAS EVIDENCIAS** al tema espec√≠fico y contexto del plan
- **ORGANIZA POR TIPO** de evidencia (cognitiva, procedimental, actitudinal)
- **CONECTA CADA EVIDENCIA** con las competencias espec√≠ficas
- **INTEGRA ELEMENTOS** del modelo cr√≠tico-social en cada evidencia
- **JUSTIFICA LA RELEVANCIA** de cada evidencia para el grado y tema

### üß† **EVIDENCIAS COGNITIVAS**
- **Conocimientos conceptuales** que debe demostrar el estudiante
- **Comprensi√≥n** de conceptos y principios
- **An√°lisis** y s√≠ntesis de informaci√≥n

### üõ†Ô∏è **EVIDENCIAS PROCEDIMENTALES**
- **Habilidades t√©cnicas** que debe desarrollar
- **Procedimientos** que debe ejecutar
- **Aplicaci√≥n pr√°ctica** de conocimientos

### üí≠ **EVIDENCIAS ACTITUDINALES**
- **Valores** que debe demostrar
- **Actitudes** hacia el aprendizaje
- **Disposici√≥n** para el trabajo colaborativo

---

## üìä EVALUACI√ìN

**Criterios de evaluaci√≥n basados en la Tabla 7 del MEN 2022:**

### üéØ **CRITERIOS DE EVALUACI√ìN**
- **Cognitivo:** Comprensi√≥n de conceptos y principios
- **Procedimental:** Aplicaci√≥n de habilidades y t√©cnicas
- **Actitudinal:** Demostraci√≥n de valores y actitudes

### üìà **INSTRUMENTOS DE EVALUACI√ìN**
- **Observaci√≥n directa**
- **Portafolio de evidencias**
- **R√∫bricas de evaluaci√≥n**
- **Autoevaluaci√≥n y coevaluaci√≥n**

### ‚è∞ **MOMENTOS DE EVALUACI√ìN**
- **Evaluaci√≥n diagn√≥stica** (inicio)
- **Evaluaci√≥n formativa** (durante el proceso)
- **Evaluaci√≥n sumativa** (final)

---

## ‚è±Ô∏è DISTRIBUCI√ìN TEMPORAL POR SESI√ìN

**L√ìGICA:** Cada sesi√≥n = 2 horas (120 minutos). Si son m√∫ltiples sesiones, cada una tiene 120 minutos.
**Calcula y muestra la distribuci√≥n exacta de los 120 minutos para cada sesi√≥n:**

**FORMATO OBLIGATORIO para cada sesi√≥n (ES PRIORIDAD MANTENER EXACTAMENTE ESTE FORMATO CON ESPACIADO Y PRIORIDAD DE TITULOS, SUBTITULOS):**

**Sesi√≥n 1: 120 minutos**

**1. Exploraci√≥n ([X] minutos):** [Descripci√≥n detallada de la actividad espec√≠fica con contexto del tema y grado]

   **Rol docente:** [Descripci√≥n espec√≠fica del rol del docente en esta actividad]
   **Rol estudiante:** [Descripci√≥n espec√≠fica del rol del estudiante en esta actividad]

**2. Problematizaci√≥n ([X] minutos):** [Descripci√≥n detallada de la actividad espec√≠fica con contexto del tema y grado]

   **Rol docente:** [Descripci√≥n espec√≠fica del rol del docente en esta actividad]
   **Rol estudiante:** [Descripci√≥n espec√≠fica del rol del estudiante en esta actividad]

**3. Di√°logo ([X] minutos):** [Descripci√≥n detallada de la actividad espec√≠fica con contexto del tema y grado]

   **Rol docente:** [Descripci√≥n espec√≠fica del rol del docente en esta actividad]
   **Rol estudiante:** [Descripci√≥n espec√≠fica del rol del estudiante en esta actividad]

**4. Praxis-Reflexi√≥n ([X] minutos):** [Descripci√≥n detallada de la actividad espec√≠fica con contexto del tema y grado]

   **Rol docente:** [Descripci√≥n espec√≠fica del rol del docente en esta actividad]
   **Rol estudiante:** [Descripci√≥n espec√≠fica del rol del estudiante en esta actividad]

**5. Acci√≥n-Transformaci√≥n ([X] minutos):** [Descripci√≥n detallada de la actividad espec√≠fica con contexto del tema y grado]

   **Rol docente:** [Descripci√≥n espec√≠fica del rol del docente en esta actividad]
   **Rol estudiante:** [Descripci√≥n espec√≠fica del rol del estudiante en esta actividad]

**Continuar con el mismo formato para todas las sesiones restantes (Sesi√≥n 2, Sesi√≥n 3, etc.)**

**INSTRUCCIONES CR√çTICAS DE FORMATO:**
- **USA markdown** para todos los t√≠tulos: sesiones, momentos pedag√≥gicos y roles
- **Mant√©n la indentaci√≥n** exacta de los roles (3 espacios)
- **Usa los emojis** exactos: üë®‚Äç para docente, ‚Äçüéì para estudiante
- **ESPACIADO OBLIGATORIO:**
  - **L√≠nea en blanco** entre la descripci√≥n de la actividad y los roles
  - **L√≠nea en blanco** entre cada momento pedag√≥gico
  - **L√≠nea en blanco** entre sesiones
  - **NO agregues** saltos de l√≠nea extra entre los roles (docente y estudiante van seguidos)
- **Mant√©n el orden** exacto: 1. Exploraci√≥n, 2. Problematizaci√≥n, 3. Di√°logo, 4. Praxis-Reflexi√≥n, 5. Acci√≥n-Transformaci√≥n
- **Formato de sesi√≥n:** **Sesi√≥n X: 120 minutos** (con markdown)
- **Formato de roles:** **üë®‚Äç Rol docente:** y **üë®‚Äçüéì Rol estudiante:** (con markdown)

**ORDEN OBLIGATORIO DE T√çTULOS:**
1. **Exploraci√≥n** - Siempre primero
2. **Problematizaci√≥n** - Siempre segundo  
3. **Di√°logo** - Siempre tercero
4. **Praxis-Reflexi√≥n** - Siempre cuarto
5. **Acci√≥n-Transformaci√≥n** - Siempre quinto

**Reglas de c√°lculo OBLIGATORIAS:**
- Los minutos deben sumar **exactamente 120** por sesi√≥n
- Redondear a m√∫ltiplos de 5 minutos para facilitar la planificaci√≥n
- Ajustar proporcionalmente seg√∫n la complejidad del tema y recursos disponibles
- Mostrar esta distribuci√≥n para **todas** las sesiones planificadas
- **CR√çTICO:** Cada descripci√≥n de actividad debe ser espec√≠fica al tema, grado y contexto
- **CR√çTICO:** Los roles del docente y estudiante deben ser espec√≠ficos y contextualizados
- **CR√çTICO:** Mantener el orden exacto de los 5 momentos pedag√≥gicos en cada sesi√≥n

---

## üìö RECURSOS Y MATERIALES

**Lista detallada de recursos necesarios para el desarrollo del plan:**

### üíª **RECURSOS TECNOL√ìGICOS**
- [Lista de recursos tecnol√≥gicos espec√≠ficos]

### üìö **RECURSOS DID√ÅCTICOS**
- [Lista de recursos did√°cticos espec√≠ficos]

### üè´ **RECURSOS F√çSICOS**
- [Lista de recursos f√≠sicos espec√≠ficos]

---

## üìã BIBLIOGRAF√çA

**Referencias bibliogr√°ficas utilizadas para la elaboraci√≥n del plan:**

- [Referencias espec√≠ficas del MEN 2022]
- [Referencias del modelo cr√≠tico-social]
- [Referencias del PEI institucional]
- [Referencias adicionales relevantes]

---

## üìù NOTAS ADICIONALES

**Observaciones y recomendaciones para la implementaci√≥n del plan:**

- [Notas espec√≠ficas para el docente]
- [Recomendaciones pedag√≥gicas]
- [Consideraciones especiales]
- [Sugerencias de mejora]

---

**FIN DEL PROMPT**`;

  return prompt;
}

// Funci√≥n para calcular el a√±o acad√©mico
function calculateAcademicYear(): string {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth() + 1; // getMonth() retorna 0-11
  
  if (month >= 1 && month <= 6) {
    return `${year - 1} - ${year}`;
  } else {
    return `${year} - ${year + 1}`;
  }
}
